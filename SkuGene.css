  :root{
    --bg:#0b0f17; --panel:#111827; --muted:#94a3b8; --text:#e5e7eb; --accent:#22c55e; --border:#1f2937;
    --btn:#0f1524; --btn-hover:#141c2e;
    --surface:#0f1524; --surface-strong:#111827; --surface-hover:#141c2e; --surface-hover-strong:#19243a;
    --overlay:#12192a; --tooltip-surface:#0f1524; --chip-bg:#0c1220;
    --shadow-color:rgba(0,0,0,0.35); --panel-shadow-right:-10px 0 32px rgba(0,0,0,0.4); --panel-shadow-left:10px 0 32px rgba(0,0,0,0.4);
    --network-gradient:linear-gradient(180deg,#0e1422,#0b0f17);
    --heat-blue:#c8f5ff; --heat-mid:#ffd08a; --heat-red:#b31212;
    --control-height:36px; --control-radius:10px;
  }
  *{box-sizing:border-box}
  body{
    margin:0;background:var(--bg);color:var(--text);
    font:14px/1.45 -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC","Hiragino Sans GB","Microsoft YaHei","Noto Sans CJK SC","Helvetica Neue",Arial,"Noto Sans",sans-serif;
  }
  .wrap{max-width:1280px;margin:24px auto;padding:0 16px}
  .head{
    display:grid;
    grid-template-columns:minmax(0,1fr) auto;
    gap:24px;
    align-items:flex-end;
    margin-bottom:20px;
  }
  .head-actions{
    display:flex;
    flex-direction:column;
    align-items:flex-end;
    gap:10px;
  }
  .head-actions__top{display:flex;align-items:center;justify-content:flex-end;gap:12px;flex-wrap:wrap}
  .head-actions__bottom{
    display:flex;
    justify-content:flex-end;
    gap:8px;
    flex-wrap:wrap;
    width:100%;
  }
  .theme-toggle{background:var(--btn);color:var(--text);border:1px solid var(--border);border-radius:999px;padding:0 16px;font-weight:600;cursor:pointer;transition:background .18s ease,color .18s ease;min-height:var(--control-height);}
  .panel-buttons{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end;}
  .panel-toggle{background:var(--btn);color:var(--text);border:1px solid var(--border);border-radius:999px;padding:0 16px;font-weight:600;cursor:pointer;transition:background .18s ease,color .18s ease;min-height:var(--control-height);}
  .panel-toggle:hover{background:var(--btn-hover);}
  .panel-toggle[aria-expanded="true"]{background:var(--accent);color:#07240f;border-color:#0f5132;}
  .theme-toggle:hover{background:var(--btn-hover);}
  .theme-toggle:focus-visible{outline:2px solid var(--accent);outline-offset:2px;}

  .title{display:flex;flex-direction:column;gap:6px}
  .title h2{margin:0;font-size:20px}
  .hint{font-size:12px;color:var(--muted)}
  .controls{display:grid;grid-template-columns:minmax(0,1.1fr) minmax(0,1.4fr);gap:18px;align-items:stretch}
  .card{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:16px;display:flex;flex-direction:column;gap:14px;height:100%;}
  .card-header{display:flex;flex-direction:column;gap:6px;}
  .card-header h3{margin:0;font-size:16px;color:var(--text);}
  .card-subtitle{margin:0;font-size:13px;color:var(--muted);}
  .card--network{margin-top:20px;}
  .toolbar-grid{
    display:grid;
    gap:12px;
    width:100%;
    grid-auto-rows:auto;
  }
  .toolbar-grid--primary{
    grid-template-columns:repeat(2,minmax(240px,1fr));
    grid-template-areas:
      "file sheet"
      "actions actions";
  }
  .toolbar-grid--secondary{
    grid-template-columns:repeat(2,minmax(220px,1fr));
    grid-template-areas:
      "search slider-min"
      "slider-speed slider-render";
  }
  .toolbar-grid .cell{
    background:var(--surface);
    border:1px solid var(--border);
    border-radius:12px;
    padding:14px;
    display:flex;
    flex-direction:column;
    gap:10px;
    height:100%;
  }
  .cell--file{grid-area:file;}
  .cell--sheet{grid-area:sheet;}
  .cell--search{grid-area:search;}
  .cell--slider-min{grid-area:slider-min;}
  .cell--slider-speed{grid-area:slider-speed;}
  .cell--slider-render{grid-area:slider-render;}
  .field{display:flex;flex-direction:column;gap:4px;min-width:0}
  .field-row{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center}
  .field-row button{min-width:max-content}
  .button-group{display:flex;align-items:center;gap:8px;flex-wrap:wrap;justify-content:flex-start}
  .cell--actions{grid-area:actions;justify-content:flex-start;align-items:flex-start}
  .button-group--wide{display:flex;gap:8px;flex-wrap:nowrap;justify-content:flex-start;width:100%;overflow-x:auto;padding-bottom:2px}
  .cell--slider{justify-content:flex-start;align-items:flex-start}
  .field-label{display:flex;justify-content:space-between;align-items:center;gap:8px}
  .field--slider{flex-direction:column;align-items:flex-start;gap:6px;width:100%}
  .field--slider .field-label{width:100%;justify-content:space-between;gap:6px}
  .field--slider input{width:100%;min-width:0}
  .input-inline{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center}
  .input-inline input{width:100%;min-width:0}
  input[type="text"], input[type="file"]{
    background:var(--btn);border:1px solid var(--border);color:var(--text);
    border-radius:var(--control-radius);
    outline:none;width:100%;min-width:0;min-height:var(--control-height);
    padding:0 12px;font:inherit;
  }
  input[type="file"]{padding:0 12px;height:var(--control-height);}
  input[type="file"]::file-selector-button,
  input[type="file"]::-webkit-file-upload-button{
    background:var(--surface-hover);border:1px solid var(--border);color:var(--text);
    border-radius:calc(var(--control-radius) - 2px);
    padding:0 12px;margin-right:12px;height:calc(var(--control-height) - 8px);
    cursor:pointer;font:inherit;
  }
  input[type="file"]::file-selector-button:hover,
  input[type="file"]::-webkit-file-upload-button:hover{background:var(--surface-hover-strong);}
  input[type="range"]{width:100%;height:24px;margin:0}
  label{color:var(--muted);font-size:13px}
  button{
    background:var(--btn);color:var(--text);border:1px solid var(--border);
    border-radius:var(--control-radius);padding:0 16px;min-height:var(--control-height);
    cursor:pointer;font-weight:600;line-height:1;display:inline-flex;align-items:center;justify-content:center;gap:8px;white-space:nowrap;
  }
  button:hover{background:var(--btn-hover)}
  button.primary{background:var(--accent);color:#07240f;border-color:#0f5132}
  button.primary:hover{filter:brightness(0.98)}
  .pill{padding:0 14px;border-radius:999px;background:var(--surface);border:1px solid var(--border);color:var(--muted);height:var(--control-height);display:inline-flex;align-items:center;gap:8px;white-space:nowrap}
  #network{height:68vh;min-height:520px;border:1px dashed var(--border);border-radius:14px;background:var(--network-gradient)}
  .footer{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
  .stats{display:flex;gap:10px;flex-wrap:nowrap}
  .badge{background:var(--surface);border:1px solid var(--border);border-radius:999px;padding:6px 10px;color:var(--muted)}
  .progress{height:8px;background:var(--surface);border:1px solid var(--border);border-radius:999px;overflow:hidden;min-width:220px}
  .bar{height:100%;background:var(--accent);width:0%}
  .legends{display:flex;gap:16px;align-items:center;flex-wrap:nowrap}
  .legend{display:flex;align-items:center;gap:8px}
  .legend .title{font-size:12px;color:var(--muted);min-width:78px;text-align:right}
  .legend .grad{width:160px;height:10px;border-radius:6px;border:1px solid var(--border);
    background: linear-gradient(90deg,var(--heat-blue) 0%, var(--heat-mid) 55%, var(--heat-red) 100%);}
  .legend .ticks{display:flex;justify-content:space-between;font-size:12px;color:var(--muted)}
  .legend small{color:var(--muted);margin-left:6px}
  #tooltip{
    position:absolute; display:none; z-index:9999; max-width:460px; min-width:300px;
    background:var(--tooltip-surface); border:1px solid var(--border); border-radius:12px; padding:0;
    box-shadow:0 6px 22px var(--shadow-color); color:var(--text); user-select:none;
  }

  #tooltip .hdr{display:flex;justify-content:space-between;align-items:center;gap:10px;background:var(--overlay);border-bottom:1px solid var(--border);padding:8px 10px;cursor:move;border-top-left-radius:12px;border-top-right-radius:12px}
  #tooltip h4{margin:0;font-size:14px}
  #tooltip .body{padding:10px 12px}
  #tooltip .meta{font-size:12px;color:var(--muted);margin-bottom:6px}
  #tooltip .list{max-height:260px;overflow:auto;font-size:12px;line-height:1.5;padding-right:12px;scrollbar-gutter:stable both-edges}
  #tooltip .list code{background:var(--chip-bg);padding:2px 4px;border-radius:6px;margin-right:6px}
#tooltip .actions{display:flex;justify-content:space-between;align-items:center;gap:8px;margin:6px 0 8px;flex-wrap:nowrap}
#tooltip .actions button{border-radius:8px;padding:0 12px;font-size:12px;cursor:pointer;border:1px solid var(--border);background:var(--surface-hover);color:var(--text);min-height:32px}
#tooltip .actions button:hover{background:var(--surface-hover-strong)}
#tooltip .actions .toggle.active{background:var(--accent);color:#07240f;border-color:#0f5132}
#tooltip .list .neighbor{padding:6px 0;border-bottom:1px solid rgba(148,163,184,0.18)}
#tooltip .list .neighbor:last-child{border-bottom:none}
#tooltip .list .neighbor-line{display:grid;grid-template-columns:auto minmax(0,1fr) auto auto;align-items:center;gap:8px}

#tooltip .list .neighbor-line .name{grid-column:2;min-width:0;word-break:break-word;line-height:1.4}
#tooltip .list .score{grid-column:3;margin-left:0;font-size:12px;color:var(--muted);white-space:nowrap}
#tooltip .list .reason{margin-top:4px;font-size:12px;color:var(--muted);white-space:normal;word-break:break-word;line-height:1.45}
  #tooltip .close{background:var(--surface-strong);border:1px solid var(--border);color:var(--text);border-radius:8px;padding:4px 8px;cursor:pointer;font-size:12px}

#tooltip .actions .danger{background:#b91c1c;border-color:#7f1d1d;color:#fff}
#tooltip .actions .danger:hover{background:#a31616}
#tooltip .actions .danger:disabled{opacity:0.45;cursor:not-allowed;background:#7f1d1d;border-color:#5f1414}
#tooltip .list .neighbor-line .edge-delete{grid-column:4;background:#3b1d1d;border:1px solid #7f1d1d;color:#fca5a5;border-radius:6px;padding:2px 6px;font-size:11px;cursor:pointer;white-space:nowrap}
#tooltip .list .neighbor-line .edge-delete:hover{background:#5f1b1b}

#tooltip .list::-webkit-scrollbar{width:6px}
#tooltip .list::-webkit-scrollbar-thumb{background:rgba(148,163,184,0.35);border-radius:6px}
#tooltip .list::-webkit-scrollbar-track{background:transparent}
#tooltip .list .neighbor-line code{grid-column:1;white-space:nowrap}

#tooltip .list .neighbor-line .spacer{display:none}

  .group-panel{
    position:fixed;
    top:24px;
    right:-360px;
    width:320px;
    height:calc(100vh - 48px);
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:16px 0 0 16px;
    box-shadow:var(--panel-shadow-right);
    transition:right .24s ease;
    z-index:970;
    display:flex;
    flex-direction:column;
  }
  .group-panel.open{right:24px;}
  .group-panel__inner{display:flex;flex-direction:column;gap:12px;height:100%;padding:16px;}
  .group-panel__header{display:flex;justify-content:space-between;align-items:center;gap:12px;}
  .group-panel__header h3{margin:0;font-size:16px;color:var(--text);}
  .group-panel__tools{display:flex;align-items:center;gap:8px;}
  .group-panel-close{background:var(--surface-strong);color:var(--muted);border:1px solid var(--border);border-radius:50%;width:28px;height:28px;font-size:14px;line-height:1;cursor:pointer;min-height:0;}
  .group-panel-close:hover{background:var(--surface-hover);color:var(--text);}
  .group-list{display:flex;flex-direction:column;gap:8px;overflow-y:auto;padding-right:4px;scrollbar-gutter:stable;}
  .group-list .placeholder{padding:12px;background:var(--surface);border:1px dashed var(--border);border-radius:10px;}
  .confirmed-list .group-item{background:var(--surface-strong);border-color:#1f2937;}
  .confirmed-list .group-item .tag{background:#161e2f;border-color:#243044;}
  .group-item{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:10px;display:flex;flex-direction:column;gap:6px;cursor:pointer;transition:background .15s ease,border-color .15s ease;}
  .group-item:hover{background:var(--surface-hover);}
  .group-item .title{font-size:14px;font-weight:600;color:var(--text);}
  .group-item .meta{display:flex;justify-content:space-between;align-items:center;font-size:12px;color:var(--muted);}
  .group-item .meta .tag{padding:4px 8px;border-radius:999px;background:var(--surface-strong);border:1px solid var(--border);color:var(--muted);font-size:11px;}
  .group-item.active{border-color:var(--accent);box-shadow:0 0 0 1px rgba(34,197,94,0.35);}
  .group-actions{display:flex;gap:6px;flex-wrap:wrap;}
  .group-actions button{padding:0 12px;font-size:12px;border-radius:8px;min-height:32px;}
  .group-actions button.confirm{background:#2563eb;border-color:#1d4ed8;color:#dbeafe;}
  .group-actions button.confirm:hover{background:#1e40af;}
  .group-actions button.undo{background:#92400e;border-color:#7c2d12;color:#fff7ed;}
  .group-actions button.undo:hover{background:#7c2d12;}

  .confirmed-panel{
    position:fixed;
    top:24px;
    left:-360px;
    width:320px;
    height:calc(100vh - 48px);
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:0 16px 16px 0;
    box-shadow:var(--panel-shadow-left);
    transition:left .24s ease;
    z-index:970;
    display:flex;
    flex-direction:column;
  }
  .confirmed-panel.open{left:24px;}
  .confirmed-panel__inner{display:flex;flex-direction:column;gap:12px;height:100%;padding:16px;}
  .confirmed-panel__header{display:flex;justify-content:space-between;align-items:center;gap:12px;}
  .confirmed-panel__header h3{margin:0;font-size:16px;color:var(--text);}
  .confirmed-panel__tools{display:flex;align-items:center;gap:8px;}
  .confirmed-panel-close{background:var(--surface-strong);color:var(--muted);border:1px solid var(--border);border-radius:50%;width:28px;height:28px;font-size:14px;line-height:1;cursor:pointer;min-height:0;}
  .confirmed-panel-close:hover{background:var(--surface-hover);color:var(--text);}
  .confirmed-panel__inner .group-list{flex:1;overflow-y:auto;padding-right:4px;}

body.theme-light{
  --bg:#f8fafc;
  --panel:#ffffff;
  --muted:#64748b;
  --text:#1f2937;
  --accent:#22c55e;
  --border:#cbd5e1;
  --btn:#ffffff;
  --btn-hover:#f1f5f9;
  --surface:#f1f5f9;
  --surface-strong:#ffffff;
  --surface-hover:#e2e8f0;
  --surface-hover-strong:#cbd5f5;
  --overlay:#e0e7ff;
  --tooltip-surface:#ffffff;
  --chip-bg:#e0e7ff;
  --shadow-color:rgba(15,23,42,0.14);
  --panel-shadow-right:-10px 0 32px rgba(15,23,42,0.18);
  --panel-shadow-left:10px 0 32px rgba(15,23,42,0.18);
  --network-gradient:linear-gradient(180deg,#f5f7fb,#e2e8f0);
  --control-height:36px;
  --control-radius:10px;
}
@media (max-width:1200px){
  .group-panel,.confirmed-panel{width:min(90vw,340px);top:16px;height:calc(100vh - 32px);}
}
@media (max-width:1024px){
  .head{grid-template-columns:1fr;}
  .head-actions{align-items:flex-start;}
  .head-actions__top{justify-content:flex-start;}
  .head-actions__bottom{justify-content:flex-start;}
  .panel-buttons{justify-content:flex-start;}
  .controls{grid-template-columns:1fr;}
}
@media (max-width:900px){
  .toolbar-grid{grid-template-columns:1fr;grid-template-areas:none;}
  .toolbar-grid .cell{grid-area:auto;}
}
@media (max-width:768px){
  .toolbar-grid .button-group{width:100%;}
  .field--slider{flex-direction:column;align-items:stretch;gap:8px}
  .field--slider .field-label{flex:0 0 auto;justify-content:space-between}
}
@media (max-width:600px){
  .head-actions__top{width:100%;}
  .head-actions__bottom{width:100%;}
  .theme-toggle,.panel-toggle{width:100%;text-align:center;}
  .field-row{flex-direction:column;align-items:stretch;gap:8px}
  .field-row button{width:100%;}
}
