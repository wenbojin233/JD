<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<title>同品关系可视化 · 持续扩散 + 可调展开速度</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<link rel="stylesheet" href="SkuGene.css"/>
</head>
<body>
  <div class="wrap">
    <div class="head">
      <div class="title">
        <h2>同品关系可视化 · 持续扩散 + 可调展开速度</h2>
        <span class="hint">默认 Sheet：<b>same_result</b> · 先选择文件，再点“构建图谱”</span>
      </div>
      <div class="head-actions">
        <div class="head-actions__top">
          <span class="pill" id="status">初始化依赖中…</span>
          <button type="button" id="toggleTheme" class="theme-toggle" aria-pressed="false">切换白天模式</button>
        </div>
        <div class="head-actions__bottom panel-buttons">
          <button type="button" id="toggleGroupPanel" class="panel-toggle" aria-expanded="false" aria-controls="groupPanel">同品组列表</button>
          <button type="button" id="toggleConfirmedPanel" class="panel-toggle" aria-expanded="false" aria-controls="confirmedPanel">已确认同品组</button>
        </div>
      </div>
    </div>
    <div class="controls">
      <div class="card">
        <div class="card-header">
          <h3>数据载入与全局操作</h3>
          <p class="card-subtitle">导入 Excel/CSV 并掌控全局布局与展开节奏</p>
        </div>
        <div class="toolbar-grid toolbar-grid--primary">
          <div class="cell cell--file">
            <div class="field field--file">
              <label for="file">数据文件</label>
              <input type="file" id="file" accept=".xlsx,.xls,.csv"/>
            </div>
          </div>
          <div class="cell cell--sheet">
            <div class="field field--sheet">
              <label for="sheet">Sheet</label>
              <div class="field-row">
                <input id="sheet" type="text" value="same_result"/>
                <button id="build" class="primary">构建图谱</button>
              </div>
            </div>
          </div>
          <div class="cell cell--actions">
            <div class="button-group button-group--wide">
              <button id="collapseAll">收起全部</button>
              <button id="explode">展开全部</button>
              <button id="pause" disabled>暂停</button>
              <button id="reset">视图复位</button>
              <button id="export">导出 PNG</button>
            </div>
          </div>
        </div>
      </div>
      <div class="card">
        <div class="card-header">
          <h3>定位检索与参数调整</h3>
          <p class="card-subtitle">快速定位目标节点，并按需调节同品组展开策略</p>
        </div>
        <div class="toolbar-grid toolbar-grid--secondary">
          <div class="cell cell--search">
            <div class="field field--search">
              <label for="search">定位节点</label>
              <div class="input-inline">
                <input id="search" type="text" placeholder="请输入节点 ID，例如 1000001"/>
                <button id="go">定位</button>
              </div>
            </div>
          </div>
          <div class="cell cell--slider cell--slider-min">
            <div class="field field--slider">
              <div class="field-label">
                <label for="minGroup">最小组件规模</label>
                <span id="minGroupLabel" class="hint">≥ 2</span>
              </div>
              <input id="minGroup" type="range" min="1" max="10" step="1" value="2"/>
            </div>
          </div>
          <div class="cell cell--slider cell--slider-speed">
            <div class="field field--slider">
              <div class="field-label">
                <label for="speed">扩散强度</label>
                <span id="speedLabel" class="hint">标准</span>
              </div>
              <input id="speed" type="range" min="1" max="5" step="1" value="3"/>
            </div>
          </div>
          <div class="cell cell--slider cell--slider-render">
            <div class="field field--slider">
              <div class="field-label">
                <label for="renderSpeed">展开速度</label>
                <span id="renderSpeedLabel" class="hint">快速</span>
              </div>
              <input id="renderSpeed" type="range" min="1" max="4" step="1" value="3"/>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="card card--network">
      <div class="card-header">
        <h3>图谱视图</h3>
        <p class="card-subtitle">查看节点关系，关注关键指标与处理进度</p>
      </div>
      <div id="network"></div>
      <div class="footer">
        <div class="stats">
          <div class="badge" id="nodesBadge">节点数: 0</div>
          <div class="badge" id="edgesBadge">边数: 0</div>
          <div class="badge" id="compBadge">组件数: 0</div>
          <div class="badge" id="maxCompBadge">最大组件大小: 0</div>
        </div>
        <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
          <div class="legends">
            <div class="legend" title="组件规模热度（P95 封顶）">
              <span class="title">组件规模热度</span>
              <div class="grad"></div>
              <div style="width:160px">
                <div class="ticks"><span>0</span><span id="gcap">P95</span></div>
              </div>
              <small id="gmaxNote">MAX: 0</small>
            </div>
            <div class="legend" title="节点度数热度（P95 封顶）">
              <span class="title">节点度数热度</span>
              <div class="grad"></div>
              <div style="width:160px">
                <div class="ticks"><span>0</span><span id="dcap">P95</span></div>
              </div>
              <small id="dmaxNote">MAX: 0</small>
            </div>
          </div>
          <div style="display:flex;align-items:center;gap:10px">
            <div class="progress"><div class="bar" id="progBar"></div></div>
            <span class="hint" id="eta">ETA: --</span>
            <span class="hint" id="hint">准备就绪</span>
          </div>
        </div>
      </div>
    </div>
    <aside class="group-panel" id="groupPanel" aria-hidden="true">
      <div class="group-panel__inner">
        <div class="group-panel__header">
          <h3>同品组列表</h3>
          <div class="group-panel__tools">
            <span id="groupListCount" class="hint">等待加载</span>
            <button type="button" id="closeGroupPanel" class="group-panel-close" aria-label="关闭同品组列表">✕</button>
          </div>
        </div>
        <div id="groupList" class="group-list">
          <div class="placeholder hint">请先加载数据以查看同品组。</div>
        </div>
      </div>
    </aside>

    <aside class="confirmed-panel" id="confirmedPanel" aria-hidden="true">
      <div class="confirmed-panel__inner">
        <div class="confirmed-panel__header">
          <h3>已确认同品组</h3>
          <div class="confirmed-panel__tools">
            <span id="confirmedListCount" class="hint">0 组</span>
            <button type="button" id="closeConfirmedPanel" class="confirmed-panel-close" aria-label="关闭已确认同品组">✕</button>
          </div>
        </div>
        <div id="confirmedList" class="group-list confirmed-list">
          <div class="placeholder hint">暂无已确认的同品组。</div>
        </div>
      </div>
    </aside>

  </div>
  <!-- 浮动节点信息框 -->
  <div id="tooltip">
    <div class="hdr" id="tipDrag">
      <h4 id="tipTitle">—</h4>
      <button class="close" onclick="hideTip()">关闭</button>
    </div>
    <div class="body">
      <div class="meta" id="tipMeta"></div>
      <div class="actions" id="tipActions">
        <button id="toggleReason" class="toggle">显示同品原因</button>
        <button id="deleteNode" class="danger">删除该节点</button>
      </div>
      <div class="list" id="tipList"></div>
    </div>
  </div>
<script src="SkuGene.js"></script>
</body>
</html>
