<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <title>同品关系可视化管理</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="SkuGene.css?v=20250217"/>
</head>
<body data-default-view="graph">
  <div class="wrap">
    <div class="head">
      <div class="title">
        <h2>同品关系可视化管理</h2>
        <span class="hint">默认 Sheet：<b>同品关系</b> · 先选择文件，再点"构建图谱"</span>
      </div>
      <div class="head-actions">
        <div class="head-actions__top">
          <span class="pill" id="status">初始化依赖中… · 构建 v20250217</span>
          <button type="button" id="toggleTheme" class="theme-toggle" aria-pressed="false">切换白天模式</button>
          <div class="history-toggle-wrapper">
            <button type="button" id="historyToggle" class="history-toggle" aria-expanded="false" aria-controls="historyPanel" aria-label="查看历史版本">
              <span class="history-toggle__icon" aria-hidden="true"></span>
            </button>
            <div class="history-panel" id="historyPanel" hidden>
              <div class="history-panel__body" id="historyList">
                <div class="history-panel__empty">暂无版本记录</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="workspace">
      <div class="history-confirm" id="historyConfirm" hidden>
        <div class="history-confirm__dialog" role="alertdialog" aria-modal="true" aria-labelledby="historyConfirmTitle">
          <h4 id="historyConfirmTitle">回溯确认</h4>
          <p class="history-confirm__desc" id="historyConfirmDesc">确认回溯到该版本吗？</p>
          <div class="history-confirm__actions">
            <button type="button" class="history-version__restore" id="historyConfirmAccept">确认回溯</button>
            <button type="button" class="history-version__restore history-version__restore--ghost" id="historyConfirmCancel">返回</button>
          </div>
        </div>
      </div>
      <div class="ai-confirm" id="aiConfirm" hidden aria-hidden="true">
        <div class="ai-confirm__dialog" role="alertdialog" aria-modal="true" aria-labelledby="aiConfirmTitle">
          <div class="ai-confirm__header">
            <div class="ai-confirm__badge">AI</div>
            <div>
              <h4 id="aiConfirmTitle">启动 工品查AI 一键聚品</h4>
              <p class="ai-confirm__subtitle">将调用工品查同品聚品自动化主薄智能体，耗时取决于您上传的数据量</p>
            </div>
          </div>
          <p class="ai-confirm__desc" id="aiConfirmDesc">确认后将继续处理当前吞并视图中的数据，期间请勿关闭页面或中断，处理完成前无法终止。</p>
          <div class="ai-confirm__actions">
            <button type="button" class="ai-confirm__primary" id="aiConfirmAccept">立即执行</button>
            <button type="button" class="ai-confirm__ghost" id="aiConfirmCancel">取消</button>
          </div>
        </div>
      </div>
      <div class="ai-progress" id="aiProgress" hidden aria-hidden="true">
        <div class="ai-progress__dialog" role="alertdialog" aria-modal="true" aria-labelledby="aiProgressTitle">
          <h4 id="aiProgressTitle">工品查同品聚品主薄任务进行中</h4>
          <p class="ai-progress__desc" id="aiProgressDesc">正在处理，请稍候…</p>
          <div class="ai-progress__bar" aria-hidden="false">
            <div class="ai-progress__bar-fill" id="aiProgressBar" style="width:0%"></div>
            <span class="ai-progress__bar-text" id="aiProgressValue">0%</span>
          </div>
          <div class="ai-progress__actions">
            <button type="button" class="ai-progress__goto" id="aiProgressGoto" data-target-url="" hidden>去工品查同源智合剔品页面</button>
          </div>
        </div>
      </div>
      <aside class="control-panel" id="controlPanel" aria-label="操作栏">
        <div class="card card--control panel-card" id="graphControlPanel">
          <section class="control-section control-section--load">
            <div class="card-header">
              <h3>数据载入与构建图谱</h3>
              <p class="card-subtitle">导入 Excel/CSV 并一键构建图谱</p>
            </div>
            <div class="toolbar-grid toolbar-grid--load">
              <div class="cell cell--file">
                <div class="field field--file">
                  <label for="file">数据文件</label>
                  <input type="file" id="file" accept=".xlsx,.xls,.csv"/>
                  <button id="build" class="primary">构建图谱</button>
                </div>
              </div>
            </div>
          </section>

          <section class="control-section control-section--search">
            <div class="card-header">
              <h3>定位检索</h3>
              <p class="card-subtitle">快速定位目标节点，联动图谱与表格</p>
            </div>
            <div class="toolbar-grid toolbar-grid--search">
              <div class="cell cell--search">
                <div class="field field--search">
                  <label for="search">定位节点</label>
                  <div class="input-inline">
                    <input id="search" type="text" placeholder="输入节点 ID 或商品名称"/>
                    <button id="go">定位</button>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section class="control-section control-section--global">
            <div class="card-header">
              <h3>全局操作</h3>
              <p class="card-subtitle">控制布局、导出图谱或触发剔品动作</p>
            </div>
            <div class="toolbar-grid toolbar-grid--single">
              <div class="cell cell--actions">
                <div class="button-group button-group--wide">
                  <button id="explode">展开全部</button>
                  <button id="reset">视图复位</button>
                  <button id="export">导出 PNG</button>
                  <button id="ultimatePrune">究极剔品</button>
                </div>
              </div>
            </div>
          </section>

          <section class="control-section control-section--keepers">
            <div class="card-header">
              <h3>同品保留条件</h3>
              <p class="card-subtitle">保持关键属性一致，避免误剔</p>
            </div>
            <div class="toolbar-grid toolbar-grid--single">
              <div class="cell cell--actions">
                <div class="button-group button-group--wide button-group--keepers">
                  <button type="button" class="keeper-btn" data-keeper="brand">品牌</button>
                  <button type="button" class="keeper-btn" data-keeper="power">功率</button>
                  <button type="button" class="keeper-btn" data-keeper="voltage">电压</button>
                  <div class="keeper-group">
                    <button type="button" class="keeper-btn" data-keeper="parentchild">父子</button>
                    <div class="score-dropdown">
                      <button type="button" class="score-dropdown__toggle" id="scoreDropdownToggle" aria-haspopup="true" aria-expanded="false">
                        <span class="score-dropdown__label">分数：100</span>
                        <span class="score-dropdown__caret" aria-hidden="true"></span>
                      </button>
                      <div class="score-dropdown__menu" id="scoreDropdownMenu" hidden>
                        <button type="button" data-score="100">100 分</button>
                        <button type="button" data-score="90">90 分</button>
                        <button type="button" data-score="70">70 分</button>
                        <button type="button" data-score="50">50 分</button>
                        <div class="score-dropdown__custom">
                          <label for="scoreDropdownCustom">自定义分数</label>
                          <div class="score-dropdown__custom-row">
                            <input id="scoreDropdownCustom" type="number" min="0" max="999" placeholder="请输入"/>
                            <button type="button" id="scoreDropdownApply">应用</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section class="control-section control-section--params">
            <div class="card-header">
              <h3>参数调整</h3>
              <p class="card-subtitle">调节组件筛选与扩散/展开速度</p>
            </div>
            <div class="toolbar-grid toolbar-grid--parameters">
              <div class="cell cell--slider cell--slider-min">
                <div class="field field--slider">
                  <div class="field-label">
                    <label for="minGroup">最小组件规模</label>
                    <span id="minGroupLabel" class="hint">≥ 2</span>
                  </div>
                  <input id="minGroup" type="range" min="1" max="10" step="1" value="2"/>
                </div>
              </div>
              <div class="cell cell--slider cell--slider-speed">
                <div class="field field--slider">
                  <div class="field-label">
                    <label for="speed">扩散强度</label>
                    <span id="speedLabel" class="hint">标准</span>
                  </div>
                  <input id="speed" type="range" min="1" max="5" step="1" value="3"/>
                </div>
              </div>
              <div class="cell cell--slider cell--slider-render">
                  <div class="field field--slider">
                    <div class="field-label">
                      <label for="renderSpeed">展开速度</label>
                      <span id="renderSpeedLabel" class="hint">快速</span>
                    </div>
                    <input id="renderSpeed" type="range" min="1" max="4" step="1" value="3"/>
                </div>
              </div>
            </div>
          </section>
        </div>
        <div class="card card--control control-panel--merge panel-card" id="mergeControlPanel" aria-hidden="true" hidden>
          <section class="control-section control-section--load">
            <div class="card-header">
              <h3>吞并视图管理</h3>
              <p class="card-subtitle">刷新吞并链数据并保持与图谱一致</p>
            </div>
            <div class="toolbar-grid toolbar-grid--load">
              <div class="cell cell--file">
                <div class="field field--file">
                  <label>同步吞并结果</label>
                  <button id="mergeRefreshStats">刷新吞并视图</button>
                </div>
              </div>
            </div>
          </section>

          <section class="control-section control-section--search">
            <div class="card-header">
              <h3>吞并节点定位</h3>
              <p class="card-subtitle">输入节点 ID，在吞并图与表格中聚焦</p>
            </div>
            <div class="toolbar-grid toolbar-grid--search">
              <div class="cell cell--search">
                <div class="field field--search">
                  <label for="mergeSearch">吞并节点</label>
                  <div class="input-inline">
                    <input id="mergeSearch" type="text" placeholder="输入节点 ID 或商品名称"/>
                    <button id="mergeLocate">定位</button>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section class="control-section control-section--global">
            <div class="card-header">
              <h3>聚品全局操作</h3>
              <p class="card-subtitle">刷新链路、导出图像或切换视图</p>
            </div>
            <div class="toolbar-grid toolbar-grid--single">
              <div class="cell cell--actions">
                <div class="button-group button-group--wide">
                  <button id="mergeResetBtn">视图复位</button>
                  <button id="mergeExportExcel">导出 Excel</button>
                </div>
              </div>
            </div>
          </section>

          <section class="control-section control-section--params">
            <div class="card-header card-header--with-action">
              <div>
                <h3>显示参数</h3>
                <p class="card-subtitle">控制吞并视图的节点/关系数量与拖动范围</p>
              </div>
              <button type="button" id="mergeAiButton" class="primary primary--danger ai-button">
                <span class="ai-button__badge" aria-hidden="true">AI</span>
                <span class="ai-button__text">AI 一键聚品</span>
              </button>
            </div>
            <div class="toolbar-grid toolbar-grid--parameters">
              <div class="cell cell--slider">
                <div class="field field--slider">
                  <div class="field-label">
                    <label for="mergeNodeLimit">节点上限</label>
                    <span id="mergeNodeLimitLabel" class="hint">520</span>
                  </div>
                  <input id="mergeNodeLimit" type="range" min="120" max="1500" step="20" value="520"/>
                </div>
              </div>
              <div class="cell cell--slider">
                <div class="field field--slider">
                  <div class="field-label">
                    <label for="mergeEdgeLimit">关系上限</label>
                    <span id="mergeEdgeLimitLabel" class="hint">720</span>
                  </div>
                  <input id="mergeEdgeLimit" type="range" min="120" max="1500" step="20" value="720"/>
                </div>
              </div>
              <div class="cell cell--slider">
                <div class="field field--slider">
                  <div class="field-label">
                    <label for="mergeDragLimit">拖动跟随节点</label>
                    <span id="mergeDragLimitLabel" class="hint">360</span>
                  </div>
                  <input id="mergeDragLimit" type="range" min="60" max="800" step="20" value="360"/>
                </div>
              </div>
            </div>
          </section>
        </div>
      </aside>
      <button type="button" id="controlToggle" class="control-toggle" aria-expanded="true" aria-controls="controlPanel" aria-label="收起操作栏">
        <span class="control-toggle__icon" aria-hidden="true"></span>
      </button>
      <section class="canvas-panel">
        <div class="card card--network">
          <div class="canvas-split" id="canvasSplit">
            <div class="canvas-split__pane canvas-split__pane--top" id="canvasSplitTop">
              <div class="card-header card-header--tabs">
                <div class="view-tabs-row">
                  <div class="view-tabs" role="tablist">
                    <button type="button" class="view-tab is-active" id="viewTabGraph" data-view-target="graph" aria-pressed="true" role="tab" aria-controls="graphViewPane">图谱视图</button>
                    <button type="button" class="view-tab" id="viewTabMerge" data-view-target="merge" aria-pressed="false" role="tab" aria-controls="mergeViewPane">吞并视图</button>
                  </div>
                    <div class="view-meta">
                      <div class="autosave-indicator" id="autosaveIndicator" role="status" aria-live="polite" data-state="saved">
                        <span class="autosave-indicator__dot" aria-hidden="true"></span>
                        <span class="autosave-indicator__text" id="autosaveIndicatorText">已保存</span>
                      </div>
                      <button type="button" class="primary primary--danger publish-inline" id="publishBtnHeader">发布</button>
                      <div class="view-stats view-stats--graph" id="graphStatsBar" aria-hidden="false">
                        <div class="view-stat"><span>节点：</span><span class="view-stat__value" id="graphStatNodes">0</span></div>
                        <div class="view-stat"><span>关系：</span><span class="view-stat__value" id="graphStatEdges">0</span></div>
                        <div class="view-stat"><span>组件：</span><span class="view-stat__value" id="graphStatComponents">0</span></div>
                        <div class="view-stat"><span>最大组件：</span><span class="view-stat__value" id="graphStatMaxGroup">0</span></div>
                    </div>
                    <div class="view-stats view-stats--merge" id="mergeStatsBar" aria-hidden="true">
                      <div class="view-stat"><span>组件：</span><span class="view-stat__value" id="mergeStatComponents">0</span></div>
                      <div class="view-stat"><span>吞并节点：</span><span class="view-stat__value" id="mergeStatVictims">0</span></div>
                      <div class="view-stat"><span>关系：</span><span class="view-stat__value" id="mergeStatEdges">0</span></div>
                      <div class="view-stat"><span>展示：</span><span class="view-stat__value" id="mergeStatNodes">0</span></div>
                    </div>
                  </div>
                </div>
                <p class="card-subtitle">查看节点关系，关注关键指标与处理进度</p>
              </div>
              <div class="view-pane view-pane--graph is-active" id="graphViewPane" role="tabpanel" aria-labelledby="viewTabGraph">
                <div id="network" class="network-canvas"></div>
              </div>
              <div class="view-pane view-pane--merge" id="mergeViewPane" role="tabpanel" aria-hidden="true" aria-labelledby="viewTabMerge" hidden>
                <div id="mergeNetwork" class="network-canvas"></div>
                <div class="merge-footer">
                  <span class="hint" id="mergeHint">暂无吞并记录，执行“剔品推荐”后查看。</span>
                </div>
              </div>
            </div>
            <div class="canvas-split__handle" id="canvasSplitHandle" role="separator" aria-label="拖动调节画布与表格尺寸" aria-orientation="vertical"></div>
            <div class="canvas-split__pane canvas-split__pane--bottom" id="canvasSplitBottom">
              <div class="table-panes">
                <div class="raw-table-card table-pane view-pane view-pane--graph is-active" id="graphTablePane" role="tabpanel" aria-labelledby="viewTabGraph">
                  <div class="raw-table-header">
                    <div>
                      <h3>原始数据表</h3>
                      <p class="card-subtitle">与已上传的 Excel / CSV 内容保持完全一致</p>
                    </div>
                    <span class="raw-table-meta" id="rawTableMeta">尚未加载</span>
                  </div>
                  <div class="raw-table-body">
                    <div class="raw-table-placeholder" id="rawTablePlaceholder">暂无数据，请先导入 Excel 或 CSV 文件。</div>
                    <div class="raw-table-scroll" id="rawTableScroll" hidden>
                      <div class="raw-table-scroll-inner" id="rawTableScrollInner">
                        <table class="raw-table" id="rawDataTable"></table>
                      </div>
                    </div>
                    <div class="raw-table-foot" id="rawTableFoot" hidden aria-hidden="true">
                      <div class="raw-table-hscroll" id="rawTableHScroll" aria-hidden="true">
                        <button type="button" class="raw-table-scroll-btn raw-table-scroll-btn--prev" id="rawTableScrollLeft" aria-label="向左滚动表格" disabled>
                          <span aria-hidden="true">&#x2039;</span>
                        </button>
                        <div class="raw-table-hscroll__scroller" id="rawTableHScrollScroller">
                          <div class="raw-table-hscroll__spacer" id="rawTableHScrollSpacer"></div>
                        </div>
                        <button type="button" class="raw-table-scroll-btn raw-table-scroll-btn--next" id="rawTableScrollRight" aria-label="向右滚动表格" disabled>
                          <span aria-hidden="true">&#x203A;</span>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="raw-table-card table-pane view-pane view-pane--merge" id="mergeTablePane" role="tabpanel" aria-labelledby="viewTabMerge" aria-hidden="true" hidden>
                  <div class="raw-table-header">
                    <div>
                      <h3>吞并视图表格</h3>
                      <p class="card-subtitle">展示吞并剔品产生的数据，随究极剔品实时更新</p>
                    </div>
                    <span class="raw-table-meta" id="mergeTableMeta">暂无吞并数据</span>
                  </div>
                  <div class="raw-table-body">
                    <div class="raw-table-placeholder" id="mergeTablePlaceholder">暂无吞并数据，执行“究极剔品”后查看。</div>
                    <div class="raw-table-scroll" id="mergeTableScroll" hidden>
                      <div class="raw-table-scroll-inner" id="mergeTableScrollInner">
                        <table class="raw-table" id="mergeDataTable"></table>
                      </div>
                    </div>
                    <div class="raw-table-foot" id="mergeTableFoot" hidden aria-hidden="true">
                      <div class="raw-table-hscroll" id="mergeTableHScroll" aria-hidden="true">
                        <button type="button" class="raw-table-scroll-btn raw-table-scroll-btn--prev" id="mergeTableScrollLeft" aria-label="向左滚动表格" disabled>
                          <span aria-hidden="true">&#x2039;</span>
                        </button>
                        <div class="raw-table-hscroll__scroller" id="mergeTableHScrollScroller">
                          <div class="raw-table-hscroll__spacer" id="mergeTableHScrollSpacer"></div>
                        </div>
                        <button type="button" class="raw-table-scroll-btn raw-table-scroll-btn--next" id="mergeTableScrollRight" aria-label="向右滚动表格" disabled>
                          <span aria-hidden="true">&#x203A;</span>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
    <aside class="prune-detail-panel" id="pruneDetailPanel" aria-hidden="true">
      <div class="prune-detail-panel__inner">
        <div class="prune-detail-panel__header">
          <h3>剔品详情</h3>
          <div class="prune-detail-panel__tools">
            <span id="pruneDetailCount" class="hint">0 个节点</span>
            <button type="button" id="closePruneDetail" class="prune-detail-close" aria-label="关闭剔品详情">✕</button>
          </div>
        </div>
        <div id="pruneDetailList" class="prune-detail-list">
          <div class="placeholder hint">暂无剔品记录。</div>
        </div>
      </div>
    </aside>

  </div>
  <!-- 浮动节点信息框 -->
  <div id="tooltip">
    <div class="hdr" id="tipDrag">
      <h4 id="tipTitle">—</h4>
      <button class="close" onclick="hideTip()">关闭</button>
    </div>
    <div class="body">
      <div class="meta" id="tipMeta"></div>
      <div class="actions" id="tipActions">
        <button id="toggleReason" class="toggle">显示同品原因</button>
        <button id="autoPruneNode" class="secondary">究极剔品</button>
        <button id="deleteNode" class="danger">删除该节点</button>
      </div>
      <div class="list" id="tipList"></div>
    </div>
  </div>
<script src="SkuGene.dom.js?v=20250217"></script>
<script src="SkuGene.worker.js?v=20250217"></script>
<script src="SkuGene.state.js?v=20250217"></script>
<script src="SkuGene.summary.js?v=20250217"></script>
<script src="SkuGene.prefix.js?v=20250217"></script>
<script src="SkuGene.tooltip.js?v=20250217"></script>
</body>
</html>
